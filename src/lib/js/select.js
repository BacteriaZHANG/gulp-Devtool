/*
 * 省市区三级，使用(class="select-address"-必须，title-非必须，value反显用-非必须)：
 * <a class="select-address" title="请选择通讯地址" value="130000,130200,130202" href="javascript:;">请选择</a>
 *
 * 一级普通下拉，使用(class="select-option"-必须)：
 * <div class="select-option">
        <select>
            <option value="0">请选择</option>
            <option value="1">1000</option>
            <option value="3">3000</option>
            <option value="2">2000</option>
            <option value="4">4000</option>
        </select>
    </div>
 *
 * 日期三级联动，使用(class="select-date"-必须，readonly-必须，value="2010-03-29"反显用-非必须)：
 * <input class="select-date" type="text" placeholder="请选择" readonly value="2010-03-29">
 *
 * 设置一级，三级高亮色，找到并修改以下代码颜色值即可：
 * var HIGHLIGNT_COLOR = '#333';
 */
var HIGHLIGNT_COLOR="#333";
function selectSwiper(e){var a=this;a.el=$(".select-level-1"),a.class=e.class||"",a.btn=$(e.btn),a.select=$(e.select),a.title=a.btn.attr("title")||"请选择",a.selectSwiper=null,a.swiperData={},a.flag=!1,a.reValued=!1,a.close=!1,a.swiperData.activeIndex="number"==typeof e.activeIndex&&e.activeIndex>=0?e.activeIndex:0,a.swiperData.oldIndex=e.index,a.swiperData.value=a.btn.attr("value"),a.swiperData.data=e.data||[];var t='<div class="select-level-1 '+a.class+'"><div class="select-container"><div class="select-btns"><a href="javascript:;" class="select-close">取消</a><span class="title">'+a.title+'</span><a href="javascript:;" class="select-ok">确定</a></div><div class="select-main"><div class="swiper-container"><div class="swiper-wrapper"></div></div></div></div></div>';a.init=function(){$("body").append(t),a.selectSwiper=new Swiper(".swiper-container",{direction:"vertical",slidesPerView:4,centeredSlides:!0,slideToClickedSlide:!0,onInit:function(e){var t=a.swiperData.data;for(i=0;i<t.length;i++)if(t[i].value==a.swiperData.value){a.swiperData.activeIndex=i;var s=a.swiperData.activeIndex;a.btn.html(a.swiperData.data[s].name)}var r=[];for(i=0;i<t.length;i++)r[i]='<div class="swiper-slide">'+t[i].name+"</div>";e.appendSlide(r)},onTransitionEnd:function(e){a.swiperData.data,a.swiperData.activeIndex=e.activeIndex}}),a.el=$(".select-level-1"),a.el.find(".select-ok").on("click",a.okSelectSwiper),a.el.find(".select-close").on("click",function(){a.closeSelectSwiper()}),$(".select-container").on("click",function(e){e.stopPropagation()})},a.okFun=function(){a.btn.html(a.swiperData.data[a.swiperData.activeIndex].name),a.btn.attr("value",a.swiperData.data[a.swiperData.activeIndex].value),a.close=!0,a.swiperData.oldIndex=a.swiperData.activeIndex,a.swiperData.value=a.swiperData.data[a.swiperData.activeIndex].value},a.openSelectSwiper=function(){a.init(),a.close=!1,a.flag=!0,a.selectSwiper.update();for(var e=0;e<a.swiperData.length;e++)a.swiperData[e].value==a.swiperData.value?a.swiperData.activeIndex=e:a.swiperData.activeIndex=0;a.selectSwiper.slideTo(a.swiperData.oldIndex,0),$.Modalshow1()},a.okSelectSwiper=function(){a.okFun(a.swiperData.activeIndex),a.closeSelectSwiper(),a.select.get(0).selectedIndex=a.swiperData.activeIndex,a.select.trigger("change")},a.closeSelectSwiper=function(){a.el.remove(),$.Modalhide2()};var s=a.btn.attr("value")||"";a.flag||"0"==s||a.btn.css("color",HIGHLIGNT_COLOR)}function addressSwiper(e){var a=this;a.el=$(".select-level-3"),a.btn=$(e.btn),a.title=a.btn.attr("title")||"请选择",a.value=e.value.concat(),a.class=e.class||"",a.flag=!1,a.flagC=!1,a.selectSwiper=null,a.selectSwiper1=null,a.selectSwiper2=null,a.resultValue=[],a.resultName=[],a.swiperData={},a.swiperData.activeIndex="number"==typeof e.activeIndex&&e.activeIndex>=0?e.activeIndex:0,a.swiperData.activeIndex1="number"==typeof e.activeIndex&&e.activeIndex>=0?e.activeIndex:0,a.swiperData.activeIndex2="number"==typeof e.activeIndex&&e.activeIndex>=0?e.activeIndex:0,a.swiperData.oldIndex=0,a.swiperData.oldIndex1=0,a.swiperData.oldIndex2=0,a.swiperData.value=e.value.concat(),a.swiperData.ProvinceData=[],a.swiperData.CityData=[],a.swiperData.DistrictData=[],a.swiperData.oldPV="",a.swiperData.oldCV="",a.swiperData.oldDV="",a.swiperData.ProvinceCode="",a.swiperData.CityCode="",a.swiperData.DistrictCode="",a.swiperData.data=e.data||[],a.swiperData.closeFun=e.closeFun||function(){};var t='<div class="select-level-3 '+a.class+'"><div class="select-container"><div class="select-btns"><a class="select-close" href="javascript:;">取消</a><span class="select-title">'+a.title+'</span><a class="select-ok" href="javascript:;">确定</a></div><div class="select-main"><div class="swiper-container" id="select-province"><div class="swiper-wrapper"></div></div><div class="swiper-container" id="select-city"><div class="swiper-wrapper"></div></div><div class="swiper-container" id="select-district"><div class="swiper-wrapper"></div></div></div></div></div>';a.init=function(){$("body").append(t),a.selectSwiper=new Swiper("#select-province",{direction:"vertical",slidesPerView:5,centeredSlides:!0,slideToClickedSlide:!0,onInit:function(t){a.resultValue=e.value,a.selectData(a.swiperData.value[0],a.swiperData.value[1]),a.resultName=[a.swiperData.ProvinceData[0].name,a.swiperData.CityData[0].name,a.swiperData.DistrictData[0].name],a.update(t,a.swiperData.ProvinceData)},onTransitionEnd:function(e){var t=a.swiperData.activeIndex=e.activeIndex;a.flag=a.swiperData.value[0]!=a.swiperData.ProvinceData[t].value,a.flag&&(a.swiperData.value[0]=a.swiperData.ProvinceData[t].value),a.selectData(a.swiperData.value[0],a.swiperData.value[1]),a.flag&&(a.swiperData.value[1]=a.swiperData.CityData[0].value),a.flag&&(a.swiperData.activeIndex1=0,a.swiperData.activeIndex2=0),e.slideTo(a.swiperData.activeIndex,0,!0),a.update(a.selectSwiper1,a.swiperData.CityData);for(var i=0;i<a.swiperData.CityData.length;i++)if(a.swiperData.value[1]==a.swiperData.CityData[i].value){a.swiperData.activeIndex1=i;break}a.flag&&(a.swiperData.value[1]=a.swiperData.CityData[0].value,a.swiperData.activeIndex1=0,a.swiperData.activeIndex2=0),a.selectSwiper1.slideTo(a.swiperData.activeIndex1,0,!0),a.selectData(a.swiperData.value[0],a.swiperData.value[1]),a.update(a.selectSwiper2,a.swiperData.DistrictData);for(var s=0;s<a.swiperData.DistrictData.length;s++)if(a.swiperData.value[2]==a.swiperData.DistrictData[s].value){a.swiperData.activeIndex2=s;break}a.selectSwiper2.slideTo(a.swiperData.activeIndex2,0,!0),a.resultValue.splice(0,a.resultValue.length),a.resultValue[0]=a.swiperData.ProvinceData[a.swiperData.activeIndex].value,a.resultValue[1]=a.swiperData.CityData[a.swiperData.activeIndex1].value,a.resultValue[2]=a.swiperData.DistrictData[a.swiperData.activeIndex2].value,a.resultName[0]=a.swiperData.ProvinceData[a.swiperData.activeIndex].name,a.resultName[1]=a.swiperData.CityData[a.swiperData.activeIndex1].name,a.resultName[2]=a.swiperData.DistrictData[a.swiperData.activeIndex2].name}}),a.selectSwiper1=new Swiper("#select-city",{direction:"vertical",slidesPerView:5,centeredSlides:!0,slideToClickedSlide:!0,onInit:function(e){a.update(e,a.swiperData.CityData)},onTransitionEnd:function(e){var t=a.swiperData.activeIndex1=e.activeIndex;a.flagC=a.swiperData.value[1]!=a.swiperData.CityData[t].value,a.swiperData.value[1]=a.swiperData.CityData[a.swiperData.activeIndex1].value,a.selectData(a.swiperData.value[0],a.swiperData.value[1]),a.update(a.selectSwiper2,a.swiperData.DistrictData),(a.flag||a.flagC)&&(a.swiperData.activeIndex2=0),a.selectSwiper2.slideTo(a.swiperData.activeIndex2,0,!0),a.resultValue[1]=a.swiperData.CityData[a.swiperData.activeIndex1].value,a.resultValue[2]=a.swiperData.DistrictData[a.swiperData.activeIndex2].value,a.resultName[1]=a.swiperData.CityData[a.swiperData.activeIndex1].name,a.resultName[2]=a.swiperData.DistrictData[0].name}}),a.selectSwiper2=new Swiper("#select-district",{direction:"vertical",slidesPerView:5,centeredSlides:!0,slideToClickedSlide:!0,onInit:function(e){a.update(e,a.swiperData.DistrictData)},onTransitionEnd:function(e){var t=a.swiperData.activeIndex2=e.activeIndex;a.swiperData.value[2]=a.swiperData.DistrictData[a.swiperData.activeIndex2].value,a.resultValue[2]=a.swiperData.DistrictData[t].value,a.resultName[2]=a.swiperData.DistrictData[t].name}}),a.el=$(".select-level-3"),a.el.find(".select-ok").on("click",a.okSelectSwiper),a.el.find(".select-close").on("click",function(){a.swiperData.closeFun(),a.closeSelectSwiper()}),a.el.on("click",function(){a.el.find(".close").trigger("click")}),$(".select").on("click",function(e){e.stopPropagation()})},a.update=function(e,a){e.removeAllSlides();var t=[];for(t.splice(0,t.length),w=0;w<a.length;w++)t[w]='<div class="swiper-slide">'+a[w].name+"</div>";e.appendSlide(t)},a.selectData=function(e,t){a.swiperData.ProvinceData.splice(0,a.swiperData.ProvinceData.length),a.swiperData.CityData.splice(0,a.swiperData.CityData.length),a.swiperData.DistrictData.splice(0,a.swiperData.DistrictData.length);for(var i=0;i<a.swiperData.data.length;i++)/\d{2}(0000)/g.test(a.swiperData.data[i].value)&&a.swiperData.ProvinceData.push(a.swiperData.data[i]),a.swiperData.data[i].parent==e&&a.swiperData.CityData.push(a.swiperData.data[i]),a.swiperData.data[i].parent==t&&a.swiperData.DistrictData.push(a.swiperData.data[i]);for(i=0;i<a.swiperData.ProvinceData.length;i++)if(a.swiperData.value[0]==a.swiperData.ProvinceData[i].value){a.swiperData.activeIndex=i;break}},a.openSelectSwiper=function(){this.init(),$.Modalshow1(),this.selectSwiper.update(),this.selectSwiper1.update(),this.selectSwiper2.update(),(this.flag||!this.reValued)&&(this.selectData(this.value[0],this.value[1]),this.selectSwiper.slideTo(this.swiperData.oldIndex,0,!0),this.update(this.selectSwiper1,this.swiperData.CityData),this.selectSwiper1.slideTo(this.swiperData.oldIndex1,0,!0),this.update(this.selectSwiper2,this.swiperData.DistrictData),this.selectSwiper2.slideTo(this.swiperData.oldIndex2,0,!0)),this.value.length&&!this.flag&&(this.selectSwiper.slideTo(this.swiperData.activeIndex,0,!0),this.selectSwiper1.slideTo(this.swiperData.activeIndex1,0,!0),this.selectSwiper2.slideTo(this.swiperData.activeIndex2,0,!0))},a.okSelectSwiper=function(){a.reValued=!0,a.swiperData.oldIndex=a.swiperData.activeIndex,a.swiperData.oldIndex1=a.swiperData.activeIndex1,a.swiperData.oldIndex2=a.swiperData.activeIndex2,a.value=a.resultValue,a.btn.attr("value",a.resultValue.join());var e=a.resultName[0]+a.resultName[1].replace(/市辖区|县/g,"")+a.resultName[2].replace(/市辖区/g,"");a.btn.text(e),a.closeSelectSwiper()},a.closeSelectSwiper=function(){a.reValued=!0,a.el.remove(),$.Modalhide2()};var i=a.btn.attr("value")||"";if(!a.flag&&i.length>=20&&/^(\d{6},){2}\d{6}$/g.test(i)){var s,r,l,n,c,d;a.swiperData.oldPV=n=i.substr(0,6),a.swiperData.oldCV=c=i.substr(7,6),a.swiperData.oldDV=d=i.substr(14,6);for(var p=[],o=[],v=[],w=0;w<a.swiperData.data.length;w++)n==a.swiperData.data[w].value&&(s=a.swiperData.data[w].name),c==a.swiperData.data[w].value&&(r=a.swiperData.data[w].name),d==a.swiperData.data[w].value&&(l=a.swiperData.data[w].name),/\d{2}(0000)/g.test(a.swiperData.data[w].value)&&p.push(a.swiperData.data[w]),a.swiperData.data[w].parent==n&&o.push(a.swiperData.data[w]),a.swiperData.data[w].parent==c&&v.push(a.swiperData.data[w]);for(a.btn.text(s+r.replace(/市辖区|县/g,"")+l.replace(/市辖区/g,"")),a.btn.css("color",HIGHLIGNT_COLOR),w=0;w<p.length;w++)if(n==p[w].value){a.swiperData.oldIndex=w;break}for(w=0;w<o.length;w++)if(c==o[w].value){a.swiperData.oldIndex1=w;break}for(w=0;w<v.length;w++)if(d==v[w].value){a.swiperData.oldIndex2=w;break}}}function dateSwiper(e){var a=this;a.el=$(".select-level-d"),a.btn=$(e.btn),a.title=a.btn.attr("title")||"请选择",a.swiperData={},a.swiperData.value=a.btn.val(),a.yearSwiper=null,a.monthSwiper=null,a.startTime=e.startTime,a.endTime=e.endTime,a.daySwiper=null,a.resultValue="",a.curYval=a.swiperData.value.substr(0,4)||(new Date).getFullYear(),a.curMval=a.swiperData.value.substr(5,2)||(new Date).getMonth()+1,a.curDval=a.swiperData.value.substr(8,2)||(new Date).getDate(),a.curYIndex=0,a.curMIndex=0,a.curDIndex=0,a.oldYIndex=a.curYval-a.startTime,a.oldMIndex=a.curMval-1,a.oldDIndex=a.curDval-1,a.endDay=31;var t='<div class="select-level-d"><div class="select-container"><div class="select-btns"><a class="select-close" href="javascript:;">取消</a><span class="select-title">'+a.title+'</span><a class="select-ok" href="javascript:;">确定</a></div><div class="select-main"><div class="swiper-container" id="select-year"><div class="swiper-wrapper"></div></div><div class="swiper-container" id="select-month"><div class="swiper-wrapper"></div></div><div class="swiper-container" id="select-day"><div class="swiper-wrapper"></div></div></div></div></div>';a.init=function(){$("body").append(t),a.yearSwiper=new Swiper("#select-year",{direction:"vertical",slidesPerView:4,centeredSlides:!0,onInit:function(e){a.update(e,a.startTime,a.endTime)},onTransitionEnd:function(e){if(a.curYIndex!=e.activeIndex)return a.curYIndex=e.activeIndex,a.curYval=e.activeIndex+a.startTime,a.updateDays(a.curMval),a.update(a.daySwiper,1,a.endDay),void a.daySwiper.slideTo(a.curDIndex,0,!1);a.updateDays(a.curMval),a.update(e,a.startTime,a.endTime)}}),a.monthSwiper=new Swiper("#select-month",{direction:"vertical",slidesPerView:4,centeredSlides:!0,onInit:function(e){a.update(e,1,12)},onTransitionEnd:function(e){if(a.curMIndex!=e.activeIndex)return a.curMIndex=e.activeIndex,a.curMval=e.activeIndex+1,a.updateDays(a.curMval),a.update(a.daySwiper,1,a.endDay),a.daySwiper.slideTo(a.curDIndex,0,!1),void(a.curDval>a.endDay?(a.curDval=a.endDay,a.daySwiper.slideTo(a.endDay-1,0,!1)):a.curMval=e.activeIndex+1);a.updateDays(a.curMval),a.update(e,1,12)}}),a.daySwiper=new Swiper("#select-day",{direction:"vertical",slidesPerView:4,centeredSlides:!0,onInit:function(e){a.updateDays(a.curMval),a.update(e,1,a.endDay)},onTransitionEnd:function(e){a.curDval=a.curDIndex=e.activeIndex+1}}),a.el=$(".select-level-d"),a.el.find(".select-ok").on("click",a.okSelectSwiper),a.el.find(".select-close").on("click",function(){a.closeSelectSwiper()}),$(".select-container").on("click",function(e){e.stopPropagation()})},a.openSelectSwiper=function(){this.init(),$.Modalshow1(),this.yearSwiper.update(),this.monthSwiper.update(),this.daySwiper.update(),this.yearSwiper.slideTo(this.oldYIndex,0,!1),this.monthSwiper.slideTo(this.oldMIndex,0,!1),this.daySwiper.slideTo(this.oldDIndex,0,!1)},a.update=function(e,t,i){e.removeAllSlides();var s=[],r=i-t;if(i>1e3){for(var l=0;l<=r;l++)t+l==a.curYval&&(a.curYIndex=l),s[l]='<div class="swiper-slide">'+(t+l)+"</div>";e.appendSlide(s)}else if(i>=28){for(l=0;l<=r;l++)t+l==a.curDval&&(a.curDIndex=l),s[l]=l<9?'<div class="swiper-slide">0'+(t+l)+"</div>":'<div class="swiper-slide">'+(t+l)+"</div>";e.appendSlide(s)}else{for(l=0;l<=r;l++)t+l==a.curMval&&(a.curMIndex=l),s[l]=l<9?'<div class="swiper-slide">0'+(t+l)+"</div>":'<div class="swiper-slide">'+(t+l)+"</div>";e.appendSlide(s)}},a.isLeapYear=function(e){a.endDay=e%4==0&&e%100!=0||e%400==0?29:28},a.updateDays=function(e){1==e||3==e||5==e||7==e||8==e||10==e||12==e?a.endDay=31:2==e?a.isLeapYear(a.curYval):a.endDay=30},a.okSelectSwiper=function(){a.btn.val("");var e=Number(a.curMval),t=Number(a.curDval);e<=9&&(e="0"+e),t<=9&&(t="0"+t),a.resultValue=a.curYval+"-"+e+"-"+t,a.btn.val(a.resultValue),a.closeSelectSwiper(),a.oldYIndex=a.curYval-a.startTime,a.oldMIndex=a.curMval-1,a.oldDIndex=a.curDval-1},a.closeSelectSwiper=function(){a.curYval=a.btn.val().substr(0,4),a.curMval=a.btn.val().substr(5,2),a.curDval=a.btn.val().substr(8,2),a.oldYIndex=a.curYval-a.startTime,a.oldMIndex=a.curMval-1,a.oldDIndex=a.curDval-1,a.el.remove(),$.Modalhide2()}}$(function(){function e(e){var a=e.get(0);new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)(function(a){for(var t=0;t<a.length;t++)"attributes"==a[t].type&&("0"!=e.attr("value")?e.css("color",HIGHLIGNT_COLOR):e.removeAttr("style"))}).observe(a,{attributes:!0,attributeFilter:["value"]})}var a;$.extend({scrollTop1:0,Modalshow1:function(e){$(e).show(),$.scrollTop1=$(window).scrollTop(),$("body").attr("style","top: -"+$.scrollTop1+"px; position: fixed;"),$(e).on("touchstart touchmove touchend",function(e){e.stopPropagation()})},Modalhide2:function(e){$(e).hide(),$("body").removeAttr("style"),$(window).scrollTop($.scrollTop1)}}),$.fn.extend({_address:function(a){return this.each(function(){var a=$(this),t=new addressSwiper({btn:a,value:(a.attr("value")||"110000,110100,110101").split(","),data:_addressData_});a.unbind("click").on("click",function(){t.openSelectSwiper()}),e(a)})},_datePicker:function(e,a){return this.each(function(){var t=$(this),i=new dateSwiper({btn:t,startTime:e||(new Date).getFullYear()-10,endTime:a||(new Date).getFullYear()+10});t.unbind("click").on("click",function(){i.openSelectSwiper()})})},_selector:function(){return this.each(function(){var a=$(this),t=a.find("select"),i=t.find("option:selected").val(),s=t.find("option:selected").text(),r=t.find("option:selected").index(),l=a.find("option"),n=[];a.append('<a class="select-highlight" value="'+i+'" href="javascript:;">'+s+"</a>").find("select").hide();for(var c=a.find("a"),d=0;d<l.length;d++){var p={};p.value=l.eq(d).attr("value"),p.name=l.eq(d).text(),n.push(p)}var o=new selectSwiper({btn:c,select:t,value:i,index:r,data:n});a.unbind("click").on("click",function(){o.openSelectSwiper()}),e(c)})}}),(a=window.jQuery)(".select-address")._address(),a(".select-date")._datePicker(),a(".select-option")._selector()});